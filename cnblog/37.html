
<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hibernate详细教程 - Sunnier - 博客园</title>
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=ChDk9h03-S75WEqNhGvXkWireJ5cCWdK1xRM9NIXfnM1"/>
<link id="MainCss" type="text/css" rel="stylesheet" href="/skins/SimpleBlue/bundle-SimpleBlue.css?v=jJERBFSojhmgst84aaRDal9S3q1WoO-WcNudmMzGJS81"/>
<link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="/skins/SimpleBlue/bundle-SimpleBlue-mobile.css?v=z0BacpCfWeLlXDCM0C158kTP_DMqMbGBapID4f-QztI1"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/sunniest/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/sunniest/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/sunniest/wlwmanifest.xml"/>
<script src="//common.cnblogs.com/script/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'sunniest', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="/bundles/blog-common.js?v=wUUQbLTt-LocHM-6RVSAUwAYdrfA1Lt3ool1ZdiICfI1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<div id="home">
<div id="header">
	<div id="blogTitle">
		
<!--done-->
<div class="title"><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/sunniest/">Sunnier</a></div>
<div class="subtitle"></div>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li id="nav_sitehome"><a id="blog_nav_sitehome" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li id="nav_myhome"><a id="blog_nav_myhome" class="menu" href="http://www.cnblogs.com/sunniest/">首页</a></li>
<li id="nav_newpost"><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li id="nav_contact"><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/Sunnier">联系</a></li>
<li id="nav_rss"><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/sunniest/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/sunniest/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li id="nav_admin"><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>

		<div class="blogStats">
			
			<div id="blog_stats">
<!--done-->
随笔-50&nbsp;
文章-0&nbsp;
评论-226&nbsp;
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class = "post">
		<h1 class = "postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/sunniest/p/4539817.html">Hibernate详细教程</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><h1><span style="color: #ff0000;"><strong><span style="font-family: 'Microsoft YaHei'; background-color: #ffff00;">Hibernate学习总结----</span></strong></span></h1>
<h2><strong><span style="font-family: 'Microsoft YaHei'; color: #000000; background-color: #ffff00;">一、搭建Hibernate环境</span></strong></h2>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">1.在src目录下创建<span style="color: #ff0000;">hibernate.cfg.xml</span>配置文件</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px; color: #ff0000;">PS:文件的名字不能改！</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE hibernate-configuration PUBLIC 
          "-//Hibernate/Hibernate Configuration DTD 3.0//EN" 
          "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">hibernate-configuration</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">session-factory</span><span style="color: #0000ff;">&gt;</span>

        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> configure the database setting </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="connection.username"</span><span style="color: #0000ff;">&gt;</span>root<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="connection.password"</span><span style="color: #0000ff;">&gt;</span>1234<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="connection.driver_class"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">com.mysql.jdbc.Driver</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="connection.url"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">jdbc:mysql://localhost:3306/test</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>

        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> configure the hibernate setting </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> transaction is supported by org.hibernate.dialect.MySQL5InnoDBDialect </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="dialect"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">org.hibernate.dialect.MySQL5InnoDBDialect</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;<br /></span><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> show sql in the console </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="show_sql"</span><span style="color: #0000ff;">&gt;</span>true<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;<br /></span>　　　　 <span style="color: #339966;">&lt;!-- create and update the database automaticlly --&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="hbm2ddl.auto"</span><span style="color: #0000ff;">&gt;</span>update<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> javax.persistence.validation.mode默认情况下是auto的，就是说如果不设置的话它是会自动去你的classpath下面找一个
        bean-validation**包，但是找不到，所以beanvalitionFactory错误 </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="javax.persistence.validation.mode"</span><span style="color: #0000ff;">&gt;</span>none<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
    
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">session-factory</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">hibernate-configuration</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p><span style="color: #000000; font-family: 'Microsoft YaHei'; font-size: 15px;">2. 编写实体类，以Person类为例</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> test.Hibernate.model;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.HashSet;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Set;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Person {
    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String toString() {
        </span><span style="color: #0000ff;">return</span> "Person [id=" + id + ", name=" + name + "]"<span style="color: #000000;">;
    }
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> getId() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> id;
    }
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setId(<span style="color: #0000ff;">int</span><span style="color: #000000;"> id) {
        </span><span style="color: #0000ff;">this</span>.id =<span style="color: #000000;"> id;
    }
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getName() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> name;
    }
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setName(String name) {
        </span><span style="color: #0000ff;">this</span>.name =<span style="color: #000000;"> name;
    }
    </span><span style="color: #0000ff;">public</span> Set&lt;String&gt;<span style="color: #000000;"> getAddress() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> address;
    }
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setAddress(Set&lt;String&gt;<span style="color: #000000;"> address) {
        </span><span style="color: #0000ff;">this</span>.address =<span style="color: #000000;"> address;
    }
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> id;
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> String name;
    </span><span style="color: #0000ff;">private</span> Set&lt;String&gt; address = <span style="color: #0000ff;">new</span> HashSet&lt;String&gt;<span style="color: #000000;">();
      
}</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">3.编写Person.hbm.xml实体类配置文件</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="utf-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 
    Mapping file autogenerated by MyEclipse Persistence Tools
</span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">hibernate-mapping </span><span style="color: #ff0000;">package</span><span style="color: #0000ff;">="test.Hibernate.model"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">class </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="Person"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="person"</span><span style="color: #0000ff;">&gt;</span>
         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">id </span><span style="color: #ff0000;">column</span><span style="color: #0000ff;">="id"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">="id"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="int"</span><span style="color: #0000ff;">&gt;</span>
             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">generator </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="native"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">generator</span><span style="color: #0000ff;">&gt;</span>
         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">id</span><span style="color: #0000ff;">&gt;</span>
         
         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="name"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="name"</span><span style="color: #ff0000;"> length</span><span style="color: #0000ff;">="50"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="string"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
         
         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">set </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="address"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="address"</span><span style="color: #0000ff;">&gt;</span>
             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">key </span><span style="color: #ff0000;">column</span><span style="color: #0000ff;">="personId"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">key</span><span style="color: #0000ff;">&gt;</span>
             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">element </span><span style="color: #ff0000;">column</span><span style="color: #0000ff;">="address"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="string"</span><span style="color: #ff0000;"> length</span><span style="color: #0000ff;">="50"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">element</span><span style="color: #0000ff;">&gt;</span>
         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">set</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">class</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">hibernate-mapping</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">4.在hibernate.cfg.xml中加入映射信息</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">mapping </span><span style="color: #ff0000;">resource</span><span style="color: #0000ff;">="test/Hibernate/model/Person.hbm.xml"</span> <span style="color: #0000ff;">/&gt;</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">5.使用MyEclipse生成SessionFactory</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> test.Hibernate.SessionFactory;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.hibernate.HibernateException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.hibernate.Session;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.hibernate.cfg.Configuration;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.hibernate.service.ServiceRegistry;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.hibernate.service.ServiceRegistryBuilder;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * Configures and provides access to Hibernate sessions, tied to the
 * current thread of execution.  Follows the Thread Local Session
 * pattern, see {</span><span style="color: #808080;">@link</span> <span style="color: #008000; text-decoration: underline;">http://hibernate.org/42.html</span><span style="color: #008000;"> }.
 </span><span style="color: #008000;">*/</span>
<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> SessionFactory {

    </span><span style="color: #008000;">/**</span><span style="color: #008000;"> 
     * Location of hibernate.cfg.xml file.
     * Location should be on the classpath as Hibernate uses  
     * #resourceAsStream style lookup for its configuration file. 
     * The default classpath location of the hibernate config file is 
     * in the default package. Use #setConfigFile() to update 
     * the location of the configuration file for the current session.   
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> ThreadLocal&lt;Session&gt; threadLocal = <span style="color: #0000ff;">new</span> ThreadLocal&lt;Session&gt;<span style="color: #000000;">();
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> org.hibernate.SessionFactory sessionFactory;
    
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> Configuration configuration = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Configuration();
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> ServiceRegistry serviceRegistry; 

    </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> {
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            configuration.configure();
            serviceRegistry </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ServiceRegistryBuilder().applySettings(configuration.getProperties()).buildServiceRegistry();
            sessionFactory </span>=<span style="color: #000000;"> configuration.buildSessionFactory(serviceRegistry);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
            System.err.println(</span>"%%%% Error Creating SessionFactory %%%%"<span style="color: #000000;">);
            e.printStackTrace();
        }
    }
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> SessionFactory() {
    }
    
    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * Returns the ThreadLocal Session instance.  Lazy initialize
     * the &lt;code&gt;SessionFactory&lt;/code&gt; if needed.
     *
     *  </span><span style="color: #808080;">@return</span><span style="color: #008000;"> Session
     *  </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> HibernateException
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> Session getSession() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> HibernateException {
        Session session </span>=<span style="color: #000000;"> (Session) threadLocal.get();

        </span><span style="color: #0000ff;">if</span> (session == <span style="color: #0000ff;">null</span> || !<span style="color: #000000;">session.isOpen()) {
            </span><span style="color: #0000ff;">if</span> (sessionFactory == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                rebuildSessionFactory();
            }
            session </span>= (sessionFactory != <span style="color: #0000ff;">null</span>) ?<span style="color: #000000;"> sessionFactory.openSession()
                    : </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;
            threadLocal.set(session);
        }

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> session;
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     *  Rebuild hibernate session factory
     *
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> rebuildSessionFactory() {
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            configuration.configure();
            serviceRegistry </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ServiceRegistryBuilder().applySettings(configuration.getProperties()).buildServiceRegistry();
            sessionFactory </span>=<span style="color: #000000;"> configuration.buildSessionFactory(serviceRegistry);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
            System.err.println(</span>"%%%% Error Creating SessionFactory %%%%"<span style="color: #000000;">);
            e.printStackTrace();
        }
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     *  Close the single hibernate session instance.
     *
     *  </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> HibernateException
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> closeSession() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> HibernateException {
        Session session </span>=<span style="color: #000000;"> (Session) threadLocal.get();
        threadLocal.set(</span><span style="color: #0000ff;">null</span><span style="color: #000000;">);

        </span><span style="color: #0000ff;">if</span> (session != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
            session.close();
        }
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     *  return session factory
     *
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> org.hibernate.SessionFactory getSessionFactory() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> sessionFactory;
    }
    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     *  return hibernate configuration
     *
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> Configuration getConfiguration() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> configuration;
    }

}</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">6.编写测试类</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> test.Hibernate.dao;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.hibernate.Session;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.hibernate.Transaction;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.junit.Test;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> test.Hibernate.SessionFactory.SessionFactory;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> test.Hibernate.model.Person;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> PersonDao {
    @Test
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> add(){
        Session session </span>=<span style="color: #000000;"> SessionFactory.getSession();
        Transaction tr </span>=<span style="color: #000000;"> session.beginTransaction();
        </span><span style="color: #008000;">//</span><span style="color: #008000;">----------------------------------------------</span>
<span style="color: #000000;">        
        Person p </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> Person();
        p.setName(</span>"test"<span style="color: #000000;">);
        p.getAddress().add(</span>"firstAddr"<span style="color: #000000;">);
        p.getAddress().add(</span>"secondAddr"<span style="color: #000000;">);
        p.getAddress().add(</span>"thirdAddr"<span style="color: #000000;">);
        p.getAddress().add(</span>"fourthAddr"<span style="color: #000000;">);        
        session.save(p);
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">----------------------------------------------</span>
<span style="color: #000000;">        tr.commit();
        SessionFactory.closeSession();
        
    }
    
    @Test
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> get(){
        Session session </span>=<span style="color: #000000;"> SessionFactory.getSession();
        Transaction tr </span>=<span style="color: #000000;"> session.beginTransaction();
        </span><span style="color: #008000;">//</span><span style="color: #008000;">----------------------------------------------</span>
<span style="color: #000000;">        
        Person p </span>= (Person)session.get(Person.<span style="color: #0000ff;">class</span>, 2<span style="color: #000000;">);
        System.out.println(p);
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">----------------------------------------------</span>
<span style="color: #000000;">        tr.commit();
        SessionFactory.closeSession();
    }
}</span></pre>
</div>
<h2><span style="font-family: 'Microsoft YaHei';"><strong><span style="color: #000000; background-color: #ffff00;">二、主键生成策略</span></strong></span></h2>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;"><strong><span style="color: #ff0000;">identity</span></strong>：使用数据库的自动增长策略，不是所有数据库都支持，比如oracle就不支持。</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;"><strong><span style="color: #ff0000;">sequence</span></strong>：在&nbsp;DB2，PostgreSQL，Oracle，SAP&nbsp;DB，McKoi&nbsp;中使用序列（sequence）在使用Oracle数据库时可以使用这一个。</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;"><strong><span style="color: #ff0000;">hilo</span></strong>:使用高低位算法生成主键值。只需要一张额外表，所有的数据都支持。</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;"><strong><span style="color: #ff0000;">native</span></strong>:根据底层数据库的能力选择&nbsp;identity、sequence&nbsp;或者&nbsp;hilo中的一个。</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;"><strong><span style="color: #ff0000;">assigned</span></strong>：手工指定主键值。</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;"><strong><span style="color: #ff0000;">uuid</span></strong>：由Hibernate自动生成UUID并指定为主键值。</span></p>
<h2><span style="background-color: #ffff00;"><strong><span style="font-family: 'Microsoft YaHei';">三、Hibernate映射关系配置</span></strong></span></h2>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">1.一对一映射（以主键关联作为示例）User与IdCard（有外键方）的XML配置：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="utf-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 
    Mapping file autogenerated by MyEclipse Persistence Tools
</span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">hibernate-mapping </span><span style="color: #ff0000;">package</span><span style="color: #0000ff;">="test.Hibernate.model"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">class </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="User"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="user"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">id </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="id"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="int"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="id"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">generator </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="native"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">generator</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">id</span><span style="color: #0000ff;">&gt;</span>
        
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="name"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="string"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="name"</span><span style="color: #0000ff;">/&gt;</span>        
        
         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">set </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="address"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="address"</span><span style="color: #0000ff;">&gt;</span>    
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">key </span><span style="color: #ff0000;">column</span><span style="color: #0000ff;">="userId"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">key</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">element </span><span style="color: #ff0000;">column</span><span style="color: #0000ff;">="address"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="string"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">element</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">set</span><span style="color: #0000ff;">&gt;</span>
        
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">one-to-one </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="idCard"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="IdCard"</span><span style="color: #ff0000;"> cascade</span><span style="color: #0000ff;">="all"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">one-to-one</span><span style="color: #0000ff;">&gt;</span>     
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">class</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">hibernate-mapping</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="utf-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 
    Mapping file autogenerated by MyEclipse Persistence Tools
</span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">hibernate-mapping </span><span style="color: #ff0000;">package</span><span style="color: #0000ff;">="test.Hibernate.model"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">class </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="IdCard"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="idCard"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">id </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="id"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="int"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="id"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">generator </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="foreign"</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="property"</span><span style="color: #0000ff;">&gt;</span>user<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">generator</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">id</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="number"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="string"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="number"</span><span style="color: #0000ff;">/&gt;</span>        
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">one-to-one </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="user"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="User"</span><span style="color: #ff0000;"> constrained</span><span style="color: #0000ff;">="true"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">one-to-one</span><span style="color: #0000ff;">&gt;</span>
        
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">class</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">hibernate-mapping</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">2.一对多，多对一（以Father和Children为例）</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="utf-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">hibernate-mapping </span><span style="color: #ff0000;">package</span><span style="color: #0000ff;">="test.Hibernate.model"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">class </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="Father"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="father"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">id </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="id"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="int"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="id"</span> <span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">generator </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="native"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">generator</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">id</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="name"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="string"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="name"</span><span style="color: #0000ff;">/&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">set </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="children"</span><span style="color: #ff0000;"> cascade</span><span style="color: #0000ff;">="all"</span><span style="color: #0000ff;">&gt;</span>
              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">key </span><span style="color: #ff0000;">column</span><span style="color: #0000ff;">="fatherId"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">key</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">one-to-many </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="Children"</span><span style="color: #0000ff;">/&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">set</span><span style="color: #0000ff;">&gt;</span>
       
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">class</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">hibernate-mapping</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="utf-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">hibernate-mapping </span><span style="color: #ff0000;">package</span><span style="color: #0000ff;">="test.Hibernate.model"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">class </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="Children"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="children"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">id </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="id"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="int"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="id"</span> <span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">generator </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="native"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">generator</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">id</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="name"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="string"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="name"</span><span style="color: #0000ff;">/&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">many-to-one </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="father"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="Father"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="fatherId"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">many-to-one</span><span style="color: #0000ff;">&gt;</span>      
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">class</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">hibernate-mapping</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">3.多对多（以Student和Teacher为例）</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px; color: #ff0000;">PS:有一方的set集合要标明inverse=true（后面会讲）</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="utf-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 
    Mapping file autogenerated by MyEclipse Persistence Tools
</span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">hibernate-mapping </span><span style="color: #ff0000;">package</span><span style="color: #0000ff;">="test.Hibernate.model"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">class </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="Student"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="student"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">id </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="id"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="int"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="id"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">generator </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="native"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">generator</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">id</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="name"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="string"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="name"</span><span style="color: #ff0000;"> length</span><span style="color: #0000ff;">="20"</span><span style="color: #0000ff;">/&gt;</span>
        
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">set </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="teachers"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="student_teacher"</span><span style="color: #ff0000;"> inverse</span><span style="color: #0000ff;">="false"</span> <span style="color: #0000ff;">&gt;</span>
               <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">key </span><span style="color: #ff0000;">column</span><span style="color: #0000ff;">="studentId"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">key</span><span style="color: #0000ff;">&gt;</span>
               <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">many-to-many </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="Teacher"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="teacherId"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">many-to-many</span><span style="color: #0000ff;">&gt;</span>              
           <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">set</span><span style="color: #0000ff;">&gt;</span>
        
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">class</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">hibernate-mapping</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="utf-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 
    Mapping file autogenerated by MyEclipse Persistence Tools
</span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">hibernate-mapping </span><span style="color: #ff0000;">package</span><span style="color: #0000ff;">="test.Hibernate.model"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">class </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="Teacher"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="teacher"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">id </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="id"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="int"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="id"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">generator </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="native"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">generator</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">id</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="name"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="name"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="string"</span><span style="color: #ff0000;"> length</span><span style="color: #0000ff;">="20"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
       
       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">set </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="students"</span><span style="color: #ff0000;"> table</span><span style="color: #0000ff;">="student_teacher"</span><span style="color: #ff0000;"> inverse</span><span style="color: #0000ff;">="true"</span><span style="color: #ff0000;"> cascade</span><span style="color: #0000ff;">="all"</span><span style="color: #0000ff;">&gt;</span>
               <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">key </span><span style="color: #ff0000;">column</span><span style="color: #0000ff;">="teacherId"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">key</span><span style="color: #0000ff;">&gt;</span>
               <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">many-to-many </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="Student"</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">="studentId"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">many-to-many</span><span style="color: #0000ff;">&gt;</span>
       <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">set</span><span style="color: #0000ff;">&gt;</span>
       
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">class</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">hibernate-mapping</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<h2><strong><span style="font-family: 'Microsoft YaHei'; background-color: #ffff00;">四、inverse和cascade的区别（个人总结，有不对还望指正）</span></strong></h2>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px; color: #ff0000;">1.inverse=false在一对多删除时是把孩子的外键设置为null，然后删除父亲，孩子不删除，而casecade=all在一对多删除时是把孩子的外键设置为null，然后删除父亲，然后再删除孩子</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px; color: #ff0000;">2.many&nbsp;to&nbsp;many的时候由一方维护，所以一方要设置inverse=false，但是inverse=true的另一方直接删除会出错，这个时候可以用casecade完成级联删除</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px; color: #ff0000;">3.inverse=false只用于set等集合属性，在one&nbsp;to&nbsp;one关系中可以用casecade完成级联删除</span></p>
<h2><strong><span style="font-family: 'Microsoft YaHei'; background-color: #ffff00;">五、使用C3P0连接池</span></strong></h2>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">1.需要额外导入3个jar包</span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;"><img src="http://images0.cnblogs.com/blog2015/694841/201505/292221575013944.png" alt="" /></span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px;">2.在hibernate.cfg.xml中加入C3P0配置信息</span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">        &lt;!--</span><span style="color: #008000;"> C3P0连接池设定</span><span style="color: #008000;">--&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 使用c3p0连接池  配置连接池提供的供应商</span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="connection.provider_class"</span><span style="color: #0000ff;">&gt;</span>org.hibernate.connection.C3P0ConnectionProvider<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">在连接池中可用的数据库连接的最少数目 </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="c3p0.min_size"</span><span style="color: #0000ff;">&gt;</span>5<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">在连接池中所有数据库连接的最大数目  </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="c3p0.max_size"</span><span style="color: #0000ff;">&gt;</span>20<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">设定数据库连接的过期时间,以秒为单位,
        如果连接池中的某个数据库连接处于空闲状态的时间超过了timeout时间,就会从连接池中清除 </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="c3p0.timeout"</span><span style="color: #0000ff;">&gt;</span>120<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
         <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">每3000秒检查所有连接池中的空闲连接 以秒为单位</span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="c3p0.idle_test_period"</span><span style="color: #0000ff;">&gt;</span>3000<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<h2><span style="font-family: 'Microsoft YaHei'; background-color: #ffff00;">六、HQL语句</span></h2>
<div class="cnblogs_code">
<pre><span style="color: #000000;">@Test
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> HQLSearch(){
        Session session </span>=<span style="color: #000000;"> SessionFactory.getSession();
        Transaction tr </span>=<span style="color: #000000;"> session.beginTransaction();
        </span><span style="color: #008000;">//</span><span style="color: #008000;">-----------------------------------------
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">common search with where
</span><span style="color: #008000;">//</span><span style="color: #008000;">        String hql= "select e.id,e.name from User e where e.id&gt;=5 and e.id&lt;=9";
</span><span style="color: #008000;">//</span><span style="color: #008000;">        Query query = session.createQuery(hql);
</span><span style="color: #008000;">//</span><span style="color: #008000;">        List list = query.list();        
</span><span style="color: #008000;">//</span><span style="color: #008000;">        for(Object o : list){            
</span><span style="color: #008000;">//</span><span style="color: #008000;">            System.out.println(Arrays.toString((Object[])o));
</span><span style="color: #008000;">//</span><span style="color: #008000;">        }
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">paging search
</span><span style="color: #008000;">//</span><span style="color: #008000;">        String hql= "select e.id,e.name from User e";
</span><span style="color: #008000;">//</span><span style="color: #008000;">        Query query = session.createQuery(hql);
</span><span style="color: #008000;">//</span><span style="color: #008000;">        query.setFirstResult(0);
</span><span style="color: #008000;">//</span><span style="color: #008000;">        query.setMaxResults(10);
</span><span style="color: #008000;">//</span><span style="color: #008000;">        List list = query.list();        
</span><span style="color: #008000;">//</span><span style="color: #008000;">        for(Object o : list){            
</span><span style="color: #008000;">//</span><span style="color: #008000;">            System.out.println(Arrays.toString((Object[])o));
</span><span style="color: #008000;">//</span><span style="color: #008000;">        }
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">search with parameters
</span><span style="color: #008000;">//</span><span style="color: #008000;">        String hql= "select e.id,e.name from User e where id&gt;=? and id&lt;=?";
</span><span style="color: #008000;">//</span><span style="color: #008000;">        Query query = session.createQuery(hql)
</span><span style="color: #008000;">//</span><span style="color: #008000;">                .setParameter(0, 1)
</span><span style="color: #008000;">//</span><span style="color: #008000;">                .setParameter(1, 3);
</span><span style="color: #008000;">//</span><span style="color: #008000;">        List list = query.list();        
</span><span style="color: #008000;">//</span><span style="color: #008000;">        for(Object o : list){            
</span><span style="color: #008000;">//</span><span style="color: #008000;">            System.out.println(Arrays.toString((Object[])o));
</span><span style="color: #008000;">//</span><span style="color: #008000;">        }
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">search with parameters whose type is collection
</span><span style="color: #008000;">//</span><span style="color: #008000;">        String hql= "select e.id,e.name from User e where id in (:ids)";
</span><span style="color: #008000;">//</span><span style="color: #008000;">        Query query = session.createQuery(hql)
</span><span style="color: #008000;">//</span><span style="color: #008000;">                .setParameterList("ids",new Object[]{1,2,3,8} );
</span><span style="color: #008000;">//</span><span style="color: #008000;">        List list = query.list();    
</span><span style="color: #008000;">//</span><span style="color: #008000;">        for(Object o : list){            
</span><span style="color: #008000;">//</span><span style="color: #008000;">            System.out.println(Arrays.toString((Object[])o));
</span><span style="color: #008000;">//</span><span style="color: #008000;">        }
        
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">-----------------------------------------</span>
<span style="color: #000000;">        tr.commit();
        SessionFactory.closeSession();
    }</span></pre>
</div>
<h2><span style="font-family: 'Microsoft YaHei'; background-color: #ffff00;">七、DML语句</span></h2>
<div class="cnblogs_code">
<pre><span style="color: #000000;">@Test
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> DML(){
        Session session </span>=<span style="color: #000000;"> SessionFactory.getSession();
        Transaction tr </span>=<span style="color: #000000;"> session.beginTransaction();
        </span><span style="color: #008000;">//</span><span style="color: #008000;">-----------------------------------------</span>
        User u = (User)session.get(User.<span style="color: #0000ff;">class</span>, 11<span style="color: #000000;">);
        
        String sql </span>= "update User set name=? where id&gt;?"<span style="color: #000000;">;
        </span><span style="color: #0000ff;">int</span> result =<span style="color: #000000;"> session.createQuery(sql)
                .setParameter(</span>0, "updated"<span style="color: #000000;">)
                .setParameter(</span>1, 10<span style="color: #000000;">)
                .executeUpdate();
        System.out.println(</span>"count of update:"+<span style="color: #000000;">result);
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">the object's status in session was not updated when the object in database have been changed,so if you want
        </span><span style="color: #008000;">//</span><span style="color: #008000;">to get the updated object in session,you should use method "refresh".</span>
<span style="color: #000000;">        session.refresh(u);
        
        System.out.println(u);
        
        </span><span style="color: #008000;">//</span><span style="color: #008000;">-----------------------------------------</span>
<span style="color: #000000;">        tr.commit();
        SessionFactory.closeSession();
    }</span></pre>
</div>
<h2><span style="font-family: 'Microsoft YaHei'; background-color: #ffff00;"><strong>&nbsp;八、开启二级缓存</strong></span></h2>
<p>1. 需要导入以下jar包</p>
<p><img src="http://images0.cnblogs.com/blog2015/694841/201505/300909488917038.png" alt="" /></p>
<p>2.在hibernate.cfg.xml中加入以下配置</p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">        &lt;!--</span><span style="color: #008000;"> 使用二级缓存，默认是未打开的。 </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 指定要使用的缓存的提供商，这也就打开了二级缓存</span><span style="color: #008000;">--&gt;</span> 
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="hibernate.cache.use_second_level_cache"</span><span style="color: #0000ff;">&gt;</span>true<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>  
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="hibernate.cache.region.factory_class"</span><span style="color: #0000ff;">&gt;</span>org.hibernate.cache.ehcache.EhCacheRegionFactory<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 开启使用查询缓存 </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="cache.use_query_cache"</span><span style="color: #0000ff;">&gt;</span>true<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008000;">        &lt;!--</span><span style="color: #008000;"> 指定要使用二级缓存的实体类 </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">class-cache </span><span style="color: #ff0000;">usage</span><span style="color: #0000ff;">="read-write"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="test.Hibernate.model.Person"</span> <span style="color: #0000ff;">/&gt;</span></pre>
</div>
<h2><span style="font-family: 'Microsoft YaHei'; background-color: #ffff00;">&nbsp;九、Hibernate对象状态及转化</span></h2>
<p><span style="font-family: 'Microsoft YaHei'; background-color: #ffff00;"><img src="http://images0.cnblogs.com/blog2015/694841/201505/301038240325176.png" alt="" width="832" height="429" /></span></p>
<p>&nbsp;</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class = "postDesc">posted @ <span id="post-date">2015-05-30 09:11</span> <a href='http://www.cnblogs.com/sunniest/'>Sunnier</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>)  <a href ="https://i.cnblogs.com/EditPosts.aspx?postid=4539817" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(4539817);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=205616,cb_entryId=4539817,cb_blogApp=currentBlogApp,cb_blogUserGuid='43282244-7c70-e411-b908-9dcfd8948a71',cb_entryCreatedDate='2015/5/30 9:11:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id='comment_form' class='commentform'>
<a name='commentform'></a>
<div id='divCommentShow'></div>
<div id='comment_nav'><span id='span_refresh_tips'></span><a href='javascript:void(0);' onclick='return RefreshCommentList();' id='lnk_RefreshComments' runat='server' clientidmode='Static'>刷新评论</a><a href='#' onclick='return RefreshPage();'>刷新页面</a><a href='#top'>返回顶部</a></div>
<div id='comment_form_container'></div>
<div class='ad_text_commentbox' id='ad_text_under_commentbox'></div>
<div id='ad_t2'></div>
<div id='opt_under_post'></div>
<div id='cnblogs_c1' class='c_ad_block'></div>
<div id='under_post_news'></div>
<div id='cnblogs_c2' class='c_ad_block'></div>
<div id='under_post_kb'></div>
<div id='HistoryToday' class='c_ad_block'></div>
<script type='text/javascript'>
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright &copy;2017 Sunnier
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
</body>
</html>
