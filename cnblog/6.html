
<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CodeSmith自己动手写模板 - Sunnier - 博客园</title>
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=ChDk9h03-S75WEqNhGvXkWireJ5cCWdK1xRM9NIXfnM1"/>
<link id="MainCss" type="text/css" rel="stylesheet" href="/skins/SimpleBlue/bundle-SimpleBlue.css?v=jJERBFSojhmgst84aaRDal9S3q1WoO-WcNudmMzGJS81"/>
<link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="/skins/SimpleBlue/bundle-SimpleBlue-mobile.css?v=z0BacpCfWeLlXDCM0C158kTP_DMqMbGBapID4f-QztI1"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/sunniest/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/sunniest/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/sunniest/wlwmanifest.xml"/>
<script src="//common.cnblogs.com/script/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'sunniest', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="/bundles/blog-common.js?v=wUUQbLTt-LocHM-6RVSAUwAYdrfA1Lt3ool1ZdiICfI1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<div id="home">
<div id="header">
	<div id="blogTitle">
		
<!--done-->
<div class="title"><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/sunniest/">Sunnier</a></div>
<div class="subtitle"></div>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li id="nav_sitehome"><a id="blog_nav_sitehome" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li id="nav_myhome"><a id="blog_nav_myhome" class="menu" href="http://www.cnblogs.com/sunniest/">首页</a></li>
<li id="nav_newpost"><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li id="nav_contact"><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/Sunnier">联系</a></li>
<li id="nav_rss"><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/sunniest/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/sunniest/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li id="nav_admin"><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>

		<div class="blogStats">
			
			<div id="blog_stats">
<!--done-->
随笔-50&nbsp;
文章-0&nbsp;
评论-226&nbsp;
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class = "post">
		<h1 class = "postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/sunniest/p/4128183.html">CodeSmith自己动手写模板</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><h1><span style="font-family: 'Microsoft YaHei';">CodeSmith学习笔记------</span></h1>
<h2><span style="font-family: 'Microsoft YaHei'; font-size: 16px; background-color: #ffff99;">1.新建一个Code Smith Generator Template(C sharp)</span></h2>
<h2><span style="font-family: 'Microsoft YaHei'; font-size: 16px; background-color: #ffff99;">2.一些常见标签的解释：</span></h2>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px; background-color: #ffffff; color: #ff0000;">①外部变量：</span></p>
<div class="cnblogs_code">
<pre>&lt;%@ Property Name=<span style="color: #800000;">"</span><span style="color: #800000;">SampleStringProperty</span><span style="color: #800000;">"</span> Default=<span style="color: #800000;">"</span><span style="color: #800000;">SomeValue</span><span style="color: #800000;">"</span> Type=<span style="color: #800000;">"</span><span style="color: #800000;">System.String</span><span style="color: #800000;">"</span> %&gt;</pre>
</div>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 14px;">表示定义一个string类型的外部变量，在需要在生成的时候才输入，此属性有默认值，也可以由用户在右下角的属性栏里修改属性的值。</span></p>
<p><img src="http://images.cnitblog.com/blog/694841/201411/281108360277212.png" alt="" /></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 14px;">还有Optional：是否允许为空(即不输入)，<span style="line-height: 1.5;">Category：是说你声明的这个属性的类别(CodeSmith会按分类分开展示让你输入)。</span></span></p>
<p><span style="font-family: 'Microsoft YaHei'; font-size: 15px; color: #ff0000;">②与数据库交互</span></p>
<p><span style="line-height: 1.5; font-family: 'Microsoft YaHei'; font-size: 14px;">CodeSmith与数据库的联系，在CodeSmith中自带一个程序集SchemaExplorer.dll，这个程序集中的类主要用于获取数据库中各种对象的结构。</span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> &lt;%@ Property Name=<span style="color: #800000;">"</span><span style="color: #800000;">SourceTable</span><span style="color: #800000;">"</span> Type=<span style="color: #800000;">"</span><span style="color: #800000;">SchemaExplorer.TableSchema</span><span style="color: #800000;">"</span> Optional=<span style="color: #800000;">"</span><span style="color: #800000;">False</span><span style="color: #800000;">"</span> Description=<span style="color: #800000;">"</span><span style="color: #800000;">源表名</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;">2</span> 
<span style="color: #008080;">3</span> &lt;%@ Property Name=<span style="color: #800000;">"</span><span style="color: #800000;">SourceDB</span><span style="color: #800000;">"</span> Type=<span style="color: #800000;">"</span><span style="color: #800000;">SchemaExplorer.DatabaseSchema</span><span style="color: #800000;">"</span> Optional=<span style="color: #800000;">"</span><span style="color: #800000;">False</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;">4</span> 
<span style="color: #008080;">5</span> &lt;%@ Assembly Name=<span style="color: #800000;">"</span><span style="color: #800000;">SchemaExplorer</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;">6</span> 
<span style="color: #008080;">7</span> &lt;%@ Import Namespace=<span style="color: #800000;">"</span><span style="color: #800000;">SchemaExplorer</span><span style="color: #800000;">"</span> %&gt;<br /><br /><br /></pre>
</div>
<pre></pre>
<pre><span style="font-family: 'Microsoft YaHei'; font-size: 14px;">Assembly：引用程序集，Import：相当于using命名空间。</span></pre>
<pre><span style="font-family: 'Microsoft YaHei'; font-size: 14px;"><span style="font-family: 'Microsoft YaHei';">Type="SchemaExplorer.DatabaseSchema"此类型会在属性栏生成一个数据库的选择框，Type="SchemaExplorer.TableSchema"即表的选择框。<br /></span><span style="font-size: 15px; color: #ff0000;">③自定义方法：</span><br /></span></pre>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> &lt;script runat=<span style="color: #800000;">"</span><span style="color: #800000;">template</span><span style="color: #800000;">"</span>&gt;
<span style="color: #008080;">2</span> <span style="color: #008000;">//</span><span style="color: #008000;"> My methods here.</span>
<span style="color: #008080;">3</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> SampleMethod()
</span><span style="color: #008080;">4</span> <span style="color: #000000;">{
</span><span style="color: #008080;">5</span>   <span style="color: #0000ff;">return</span> <span style="color: #800000;">"</span><span style="color: #800000;">Method output.</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">6</span> <span style="color: #000000;">}
</span><span style="color: #008080;">7</span> &lt;/script&gt;</pre>
</div>
<pre><span style="font-size: 14px; font-family: 'Microsoft YaHei';">&lt;script runat="template"&gt;&lt;/script&gt;标签内写的是自定义函数（C#代码）<br /><span style="font-size: 15px; color: #ff0000;">④模板部分书写：</span><br />C#代码要用&lt;%%&gt;包括，值类型要使用&lt;%=%&gt;<br />例如：生成一个Model层的模板<br /></span></pre>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">using</span><span style="color: #000000;"> System;
</span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections.Generic;
</span><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Text;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> N<span style="color: #000000;">amespace Model
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 7</span>     Class &lt;%=TargetTable.Name%&gt;
<span style="color: #008080;"> 8</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 9</span>         &lt;%  <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i=<span style="color: #800080;">0</span>;i&lt;TargetTable.Columns.Count;i++<span style="color: #000000;">)
</span><span style="color: #008080;">10</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">11</span>             SchemaExplorer.ColumnSchema col = TargetTable.Columns[i];%&gt;
<span style="color: #008080;">12</span>             <span style="color: #0000ff;">public</span> &lt;%=col.SystemType%&gt; &lt;%=col.Name%&gt;{<span style="color: #0000ff;">get</span>;<span style="color: #0000ff;">set</span><span style="color: #000000;">;}
</span><span style="color: #008080;">13</span>       &lt;%}%&gt;
<span style="color: #008080;">14</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">15</span> }</pre>
</div>
<p><span style="color: #ff0000; font-size: 15px;">⑤一份完整的DAL的模板示例：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">  1</span> &lt;%@ CodeTemplate Language=<span style="color: #800000;">"</span><span style="color: #800000;">C#</span><span style="color: #800000;">"</span> TargetLanguage=<span style="color: #800000;">"</span><span style="color: #800000;">C#</span><span style="color: #800000;">"</span> 
<span style="color: #008080;">  2</span>     Src=<span style="color: #800000;">"</span><span style="color: #800000;">ToolsCodeTemplate.cs</span><span style="color: #800000;">"</span> Inherits=<span style="color: #800000;">"</span><span style="color: #800000;">ToolsCodeTemplate</span><span style="color: #800000;">"</span>%&gt;
<span style="color: #008080;">  3</span> &lt;%@ Property Name=<span style="color: #800000;">"</span><span style="color: #800000;">TargetTable</span><span style="color: #800000;">"</span> Type=<span style="color: #800000;">"</span><span style="color: #800000;">SchemaExplorer.TableSchema</span><span style="color: #800000;">"</span> Category=<span style="color: #800000;">"</span><span style="color: #800000;">Context</span><span style="color: #800000;">"</span> Description=<span style="color: #800000;">"</span><span style="color: #800000;">TargetTable that the object is based on.</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;">  4</span> &lt;%@ Property Name=<span style="color: #800000;">"</span><span style="color: #800000;">ModelsNamespace</span><span style="color: #800000;">"</span> Default=<span style="color: #800000;">"</span><span style="color: #800000;">MyOffice.Models</span><span style="color: #800000;">"</span> Type=<span style="color: #800000;">"</span><span style="color: #800000;">System.String</span><span style="color: #800000;">"</span> Category=<span style="color: #800000;">"</span><span style="color: #800000;">Context</span><span style="color: #800000;">"</span> Description=<span style="color: #800000;">"</span><span style="color: #800000;">TargetTable that the object is based on.</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;">  5</span> &lt;%@ Property Name=<span style="color: #800000;">"</span><span style="color: #800000;">DALNamespace</span><span style="color: #800000;">"</span> Default=<span style="color: #800000;">"</span><span style="color: #800000;">MyOffice.DAL</span><span style="color: #800000;">"</span> Type=<span style="color: #800000;">"</span><span style="color: #800000;">System.String</span><span style="color: #800000;">"</span> Category=<span style="color: #800000;">"</span><span style="color: #800000;">Context</span><span style="color: #800000;">"</span> Description=<span style="color: #800000;">"</span><span style="color: #800000;">TargetTable that the object is based on.</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;">  6</span> &lt;%@ Property Name=<span style="color: #800000;">"</span><span style="color: #800000;">DALClassNameSurfix</span><span style="color: #800000;">"</span> Default=<span style="color: #800000;">"</span><span style="color: #800000;">Service</span><span style="color: #800000;">"</span> Type=<span style="color: #800000;">"</span><span style="color: #800000;">System.String</span><span style="color: #800000;">"</span> Category=<span style="color: #800000;">"</span><span style="color: #800000;">Context</span><span style="color: #800000;">"</span> Description=<span style="color: #800000;">"</span><span style="color: #800000;">TargetTable that the object is based on.</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;">  7</span> &lt;%@ Assembly Name=<span style="color: #800000;">"</span><span style="color: #800000;">SchemaExplorer</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;">  8</span> &lt;%@ Assembly Name=<span style="color: #800000;">"</span><span style="color: #800000;">System.Data</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;">  9</span> &lt;%@ Import Namespace=<span style="color: #800000;">"</span><span style="color: #800000;">SchemaExplorer</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;"> 10</span> &lt;%@ Import Namespace=<span style="color: #800000;">"</span><span style="color: #800000;">System.Data</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;"> 11</span> &lt;%@ Import Namespace=<span style="color: #800000;">"</span><span style="color: #800000;">System.Text.RegularExpressions</span><span style="color: #800000;">"</span> %&gt;
<span style="color: #008080;"> 12</span> &lt;% PrintHeader(); %&gt;
<span style="color: #008080;"> 13</span> <span style="color: #0000ff;">using</span><span style="color: #000000;"> System;
</span><span style="color: #008080;"> 14</span> <span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections.Generic;
</span><span style="color: #008080;"> 15</span> <span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Text;
</span><span style="color: #008080;"> 16</span> <span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data;
</span><span style="color: #008080;"> 17</span> <span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data.SqlClient;
</span><span style="color: #008080;"> 18</span> <span style="color: #0000ff;">using</span> &lt;%= ModelsNamespace %&gt;<span style="color: #000000;">;
</span><span style="color: #008080;"> 19</span> 
<span style="color: #008080;"> 20</span> <span style="color: #0000ff;">namespace</span> &lt;%= DALNamespace %&gt;
<span style="color: #008080;"> 21</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 22</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">partial</span> <span style="color: #0000ff;">class</span> &lt;%= GetDALClassName() %&gt;
<span style="color: #008080;"> 23</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 24</span>         &lt;%-- <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> Book AddBook(Book book) --%&gt;
<span style="color: #008080;"> 25</span>         <span style="color: #0000ff;">public</span> &lt;%= GetModelClassName() %&gt;<span style="color: #000000;"> Add
</span><span style="color: #008080;"> 26</span>             (&lt;%= GetModelClassName() %&gt; &lt;%= GetModelParamName() %&gt;<span style="color: #000000;">)
</span><span style="color: #008080;"> 27</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 28</span>             &lt;%<span style="color: #0000ff;">if</span><span style="color: #000000;">(IsIdentityPK())
</span><span style="color: #008080;"> 29</span>             {%&gt;
<span style="color: #008080;"> 30</span>                 <span style="color: #0000ff;">string</span> sql =<span style="color: #800000;">"</span><span style="color: #800000;">&lt;%= GetAutoIncInsertSQLLine()%&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 31</span>                 SqlParameter[] para = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SqlParameter[]
</span><span style="color: #008080;"> 32</span> <span style="color: #000000;">                    {
</span><span style="color: #008080;"> 33</span>                         &lt;%
<span style="color: #008080;"> 34</span>                         <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span> i=<span style="color: #800080;">0</span>; i&lt;TargetTable.NonPrimaryKeyColumns.Count; i++<span style="color: #000000;">)
</span><span style="color: #008080;"> 35</span> <span style="color: #000000;">                        {
</span><span style="color: #008080;"> 36</span>                             ColumnSchema column =<span style="color: #000000;"> TargetTable.NonPrimaryKeyColumns[i];
</span><span style="color: #008080;"> 37</span>                             
<span style="color: #008080;"> 38</span>                         %&gt;
<span style="color: #008080;"> 39</span>                         <span style="color: #0000ff;">new</span> SqlParameter(<span style="color: #800000;">"</span><span style="color: #800000;">@&lt;%= column.Name %&gt;</span><span style="color: #800000;">"</span>, ToDBValue(&lt;%= GetModelParamName() %&gt;.&lt;%= column.Name %&gt;<span style="color: #000000;">)),
</span><span style="color: #008080;"> 40</span>                         &lt;%
<span style="color: #008080;"> 41</span> <span style="color: #000000;">                        }
</span><span style="color: #008080;"> 42</span>                         %&gt;
<span style="color: #008080;"> 43</span> <span style="color: #000000;">                    };
</span><span style="color: #008080;"> 44</span>                     
<span style="color: #008080;"> 45</span>                 &lt;%= GetPKPropertyType() %&gt; newId = (&lt;%= GetPKPropertyType() %&gt;<span style="color: #000000;">)SqlHelper.ExecuteScalar(sql, para);
</span><span style="color: #008080;"> 46</span>                 <span style="color: #0000ff;">return</span> GetBy&lt;%= GetPKPropertyName() %&gt;<span style="color: #000000;">(newId);
</span><span style="color: #008080;"> 47</span>             &lt;%}<span style="color: #0000ff;">else</span>
<span style="color: #008080;"> 48</span>             {%&gt;
<span style="color: #008080;"> 49</span>                 <span style="color: #0000ff;">string</span> sql =<span style="color: #800000;">"</span><span style="color: #800000;">&lt;%= GetCommonInsertSQLLine()%&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 50</span>                 SqlParameter[] para = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SqlParameter[]
</span><span style="color: #008080;"> 51</span> <span style="color: #000000;">                    {
</span><span style="color: #008080;"> 52</span>                         &lt;%
<span style="color: #008080;"> 53</span>                         <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span> i=<span style="color: #800080;">0</span>; i&lt;TargetTable.Columns.Count; i++<span style="color: #000000;">)
</span><span style="color: #008080;"> 54</span> <span style="color: #000000;">                        {
</span><span style="color: #008080;"> 55</span>                             ColumnSchema column =<span style="color: #000000;"> TargetTable.Columns[i];                            
</span><span style="color: #008080;"> 56</span>                         %&gt;
<span style="color: #008080;"> 57</span>                         <span style="color: #0000ff;">new</span> SqlParameter(<span style="color: #800000;">"</span><span style="color: #800000;">@&lt;%= column.Name %&gt;</span><span style="color: #800000;">"</span>, ToDBValue(&lt;%= GetModelParamName() %&gt;.&lt;%= column.Name %&gt;<span style="color: #000000;">)),
</span><span style="color: #008080;"> 58</span>                         &lt;%
<span style="color: #008080;"> 59</span> <span style="color: #000000;">                        }
</span><span style="color: #008080;"> 60</span>                         %&gt;
<span style="color: #008080;"> 61</span> <span style="color: #000000;">                    };
</span><span style="color: #008080;"> 62</span> <span style="color: #000000;">                SqlHelper.ExecuteNonQuery(sql, para);
</span><span style="color: #008080;"> 63</span>                 <span style="color: #0000ff;">return</span> &lt;%= GetModelParamName() %&gt;<span style="color: #000000;">;                
</span><span style="color: #008080;"> 64</span>             &lt;%}%&gt;
<span style="color: #008080;"> 65</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 66</span> 
<span style="color: #008080;"> 67</span>         &lt;%-- <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">bool</span> DeleteBookById(<span style="color: #0000ff;">int</span> id) --%&gt;
<span style="color: #008080;"> 68</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> DeleteBy&lt;%= GetPKPropertyName() %&gt;(&lt;%= GetPKPropertyType() %&gt; &lt;%= GetPKParamName() %&gt;<span style="color: #000000;">)
</span><span style="color: #008080;"> 69</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 70</span>             <span style="color: #0000ff;">string</span> sql = <span style="color: #800000;">"</span><span style="color: #800000;">DELETE &lt;%= TargetTable.Name %&gt; WHERE &lt;%= GetPKPropertyName() %&gt; = @&lt;%= GetPKPropertyName() %&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 71</span> 
<span style="color: #008080;"> 72</span>            SqlParameter[] para = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SqlParameter[]
</span><span style="color: #008080;"> 73</span> <span style="color: #000000;">            {
</span><span style="color: #008080;"> 74</span>                 <span style="color: #0000ff;">new</span> SqlParameter(<span style="color: #800000;">"</span><span style="color: #800000;">@&lt;%= GetPKName() %&gt;</span><span style="color: #800000;">"</span>, &lt;%= GetPKParamName() %&gt;<span style="color: #000000;">)
</span><span style="color: #008080;"> 75</span> <span style="color: #000000;">            };
</span><span style="color: #008080;"> 76</span>         
<span style="color: #008080;"> 77</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> SqlHelper.ExecuteNonQuery(sql, para);
</span><span style="color: #008080;"> 78</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 79</span>         
<span style="color: #008080;"> 80</span>                 
<span style="color: #008080;"> 81</span>         &lt;%-- <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">bool</span> ModifyBook(Book book) --%&gt;
<span style="color: #008080;"> 82</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Update(&lt;%= GetModelClassName() %&gt; &lt;%= GetModelParamName() %&gt;<span style="color: #000000;">)
</span><span style="color: #008080;"> 83</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 84</span>             <span style="color: #0000ff;">string</span> sql =
<span style="color: #008080;"> 85</span>                 <span style="color: #800000;">"</span><span style="color: #800000;">UPDATE &lt;%= TargetTable.Name %&gt; </span><span style="color: #800000;">"</span> +
<span style="color: #008080;"> 86</span>                 <span style="color: #800000;">"</span><span style="color: #800000;">SET </span><span style="color: #800000;">"</span> +
<span style="color: #008080;"> 87</span>             <span style="color: #800000;">"</span><span style="color: #800000;"> &lt;%= TargetTable.NonPrimaryKeyColumns[0].Name %&gt; = @&lt;%= TargetTable.NonPrimaryKeyColumns[0].Name %&gt;</span><span style="color: #800000;">"</span> 
<span style="color: #008080;"> 88</span>             &lt;%
<span style="color: #008080;"> 89</span>             <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span> i=<span style="color: #800080;">1</span>; i&lt;TargetTable.NonPrimaryKeyColumns.Count; i++<span style="color: #000000;">)
</span><span style="color: #008080;"> 90</span> <span style="color: #000000;">            {
</span><span style="color: #008080;"> 91</span>                 ColumnSchema column =<span style="color: #000000;"> TargetTable.NonPrimaryKeyColumns[i];                
</span><span style="color: #008080;"> 92</span>             %&gt;
<span style="color: #008080;"> 93</span>                 +<span style="color: #800000;">"</span><span style="color: #800000;">, &lt;%= column.Name %&gt; = @&lt;%= column.Name %&gt;</span><span style="color: #800000;">"</span> 
<span style="color: #008080;"> 94</span>             &lt;%
<span style="color: #008080;"> 95</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 96</span>             %&gt;
<span style="color: #008080;"> 97</span>                
<span style="color: #008080;"> 98</span>             +<span style="color: #800000;">"</span><span style="color: #800000;"> WHERE &lt;%= GetPKName() %&gt; = @&lt;%= GetPKName() %&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 99</span> 
<span style="color: #008080;">100</span> 
<span style="color: #008080;">101</span>             SqlParameter[] para = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SqlParameter[]
</span><span style="color: #008080;">102</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">103</span>                 <span style="color: #0000ff;">new</span> SqlParameter(<span style="color: #800000;">"</span><span style="color: #800000;">@&lt;%= GetPKName() %&gt;</span><span style="color: #800000;">"</span>, &lt;%= GetModelParamName() %&gt;.&lt;%= GetPKName() %&gt;<span style="color: #000000;">)
</span><span style="color: #008080;">104</span>                 &lt;%
<span style="color: #008080;">105</span>                 <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span> i=<span style="color: #800080;">0</span>; i&lt;TargetTable.NonPrimaryKeyColumns.Count; i++<span style="color: #000000;">)
</span><span style="color: #008080;">106</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">107</span>                     ColumnSchema column =<span style="color: #000000;"> TargetTable.NonPrimaryKeyColumns[i];
</span><span style="color: #008080;">108</span>                 %&gt;
<span style="color: #008080;">109</span>                     ,<span style="color: #0000ff;">new</span> SqlParameter(<span style="color: #800000;">"</span><span style="color: #800000;">@&lt;%= column.Name %&gt;</span><span style="color: #800000;">"</span>, ToDBValue(&lt;%= GetModelParamName() %&gt;.&lt;%= column.Name %&gt;<span style="color: #000000;">))
</span><span style="color: #008080;">110</span>                 &lt;%
<span style="color: #008080;">111</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">112</span>                 %&gt;
<span style="color: #008080;">113</span> <span style="color: #000000;">            };
</span><span style="color: #008080;">114</span> 
<span style="color: #008080;">115</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> SqlHelper.ExecuteNonQuery(sql, para);
</span><span style="color: #008080;">116</span> <span style="color: #000000;">        }        
</span><span style="color: #008080;">117</span>         
<span style="color: #008080;">118</span>         &lt;%-- <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> Book GetBookById(<span style="color: #0000ff;">int</span> id) --%&gt;
<span style="color: #008080;">119</span>         <span style="color: #0000ff;">public</span> &lt;%= GetModelClassName() %&gt; GetBy&lt;%= GetPKPropertyName() %&gt;(&lt;%= GetPKPropertyType() %&gt; &lt;%= GetPKParamName() %&gt;<span style="color: #000000;">)
</span><span style="color: #008080;">120</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">121</span>             <span style="color: #0000ff;">string</span> sql = <span style="color: #800000;">"</span><span style="color: #800000;">SELECT * FROM &lt;%= TargetTable.Name %&gt; WHERE &lt;%= GetPKPropertyName() %&gt; = @&lt;%= GetPKPropertyName() %&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">122</span>             <span style="color: #0000ff;">using</span>(SqlDataReader reader = SqlHelper.ExecuteDataReader(sql, <span style="color: #0000ff;">new</span> SqlParameter(<span style="color: #800000;">"</span><span style="color: #800000;">@&lt;%= GetPKPropertyName() %&gt;</span><span style="color: #800000;">"</span>, &lt;%= GetPKParamName() %&gt;<span style="color: #000000;">)))
</span><span style="color: #008080;">123</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">124</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (reader.Read())
</span><span style="color: #008080;">125</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">126</span>                     <span style="color: #0000ff;">return</span><span style="color: #000000;"> ToModel(reader);
</span><span style="color: #008080;">127</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">128</span>                 <span style="color: #0000ff;">else</span>
<span style="color: #008080;">129</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">130</span>                     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">131</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">132</span> <span style="color: #000000;">               }
</span><span style="color: #008080;">133</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">134</span>         
<span style="color: #008080;">135</span>         <span style="color: #0000ff;">public</span> &lt;%= GetModelClassName() %&gt;<span style="color: #000000;"> ToModel(SqlDataReader reader)
</span><span style="color: #008080;">136</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">137</span>             &lt;%= GetModelClassName() %&gt; &lt;%= GetModelParamName() %&gt; = <span style="color: #0000ff;">new</span> &lt;%= GetModelClassName() %&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">138</span> 
<span style="color: #008080;">139</span>             &lt;% <span style="color: #0000ff;">foreach</span>(ColumnSchema column <span style="color: #0000ff;">in</span> TargetTable.Columns) %&gt;
<span style="color: #008080;">140</span>             &lt;% { %&gt;
<span style="color: #008080;">141</span>             &lt;%= GetModelParamName() %&gt;.&lt;%= GetPropertyName(column) %&gt; = (&lt;%=GetPropertyType(column)%&gt;)ToModelValue(reader,<span style="color: #800000;">"</span><span style="color: #800000;">&lt;%=column.Name%&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #008080;">142</span>             &lt;% } %&gt;
<span style="color: #008080;">143</span>             <span style="color: #0000ff;">return</span> &lt;%= GetModelParamName() %&gt;<span style="color: #000000;">;
</span><span style="color: #008080;">144</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">145</span>         
<span style="color: #008080;">146</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> GetTotalCount()
</span><span style="color: #008080;">147</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">148</span>             <span style="color: #0000ff;">string</span> sql = <span style="color: #800000;">"</span><span style="color: #800000;">SELECT count(*) FROM &lt;%= TargetTable.Name %&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">149</span>             <span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">int</span><span style="color: #000000;">)SqlHelper.ExecuteScalar(sql);
</span><span style="color: #008080;">150</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">151</span>         
<span style="color: #008080;">152</span>         <span style="color: #0000ff;">public</span> IEnumerable&lt;&lt;%= GetModelClassName() %&gt;&gt; GetPagedData(<span style="color: #0000ff;">int</span> minrownum,<span style="color: #0000ff;">int</span><span style="color: #000000;"> maxrownum)
</span><span style="color: #008080;">153</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">154</span>             <span style="color: #0000ff;">string</span> sql = <span style="color: #800000;">"</span><span style="color: #800000;">SELECT * from(SELECT *,row_number() over(order by &lt;%=this.GetPKName()%&gt;) rownum FROM &lt;%= TargetTable.Name %&gt;) t where rownum&gt;=@minrownum and rownum&lt;=@maxrownum</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">155</span>             <span style="color: #0000ff;">using</span>(SqlDataReader reader =<span style="color: #000000;"> SqlHelper.ExecuteDataReader(sql,
</span><span style="color: #008080;">156</span>                 <span style="color: #0000ff;">new</span> SqlParameter(<span style="color: #800000;">"</span><span style="color: #800000;">@minrownum</span><span style="color: #800000;">"</span><span style="color: #000000;">,minrownum),
</span><span style="color: #008080;">157</span>                 <span style="color: #0000ff;">new</span> SqlParameter(<span style="color: #800000;">"</span><span style="color: #800000;">@maxrownum</span><span style="color: #800000;">"</span><span style="color: #000000;">,maxrownum)))
</span><span style="color: #008080;">158</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">159</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> ToModels(reader);                    
</span><span style="color: #008080;">160</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">161</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">162</span>         
<span style="color: #008080;">163</span>         <span style="color: #0000ff;">public</span> IEnumerable&lt;&lt;%= GetModelClassName() %&gt;&gt;<span style="color: #000000;"> GetAll()
</span><span style="color: #008080;">164</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">165</span>             <span style="color: #0000ff;">string</span> sql = <span style="color: #800000;">"</span><span style="color: #800000;">SELECT * FROM &lt;%= TargetTable.Name %&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">166</span>             <span style="color: #0000ff;">using</span>(SqlDataReader reader =<span style="color: #000000;"> SqlHelper.ExecuteDataReader(sql))
</span><span style="color: #008080;">167</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">168</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> ToModels(reader);            
</span><span style="color: #008080;">169</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">170</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">171</span>         
<span style="color: #008080;">172</span>         <span style="color: #0000ff;">protected</span> IEnumerable&lt;&lt;%= GetModelClassName() %&gt;&gt;<span style="color: #000000;"> ToModels(SqlDataReader reader)
</span><span style="color: #008080;">173</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">174</span>             <span style="color: #0000ff;">var</span> list = <span style="color: #0000ff;">new</span> List&lt;&lt;%= GetModelClassName() %&gt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">175</span>             <span style="color: #0000ff;">while</span><span style="color: #000000;">(reader.Read())
</span><span style="color: #008080;">176</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">177</span> <span style="color: #000000;">                list.Add(ToModel(reader));
</span><span style="color: #008080;">178</span> <span style="color: #000000;">            }    
</span><span style="color: #008080;">179</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> list;
</span><span style="color: #008080;">180</span> <span style="color: #000000;">        }        
</span><span style="color: #008080;">181</span>         
<span style="color: #008080;">182</span>         <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">object</span> ToDBValue(<span style="color: #0000ff;">object</span><span style="color: #000000;"> value)
</span><span style="color: #008080;">183</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">184</span>             <span style="color: #0000ff;">if</span>(value==<span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">185</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">186</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> DBNull.Value;
</span><span style="color: #008080;">187</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">188</span>             <span style="color: #0000ff;">else</span>
<span style="color: #008080;">189</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">190</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> value;
</span><span style="color: #008080;">191</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">192</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">193</span>         
<span style="color: #008080;">194</span>         <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">object</span> ToModelValue(SqlDataReader reader,<span style="color: #0000ff;">string</span><span style="color: #000000;"> columnName)
</span><span style="color: #008080;">195</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">196</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;">(reader.IsDBNull(reader.GetOrdinal(columnName)))
</span><span style="color: #008080;">197</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">198</span>                 <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">199</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">200</span>             <span style="color: #0000ff;">else</span>
<span style="color: #008080;">201</span> <span style="color: #000000;">            {
</span><span style="color: #008080;">202</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> reader[columnName];
</span><span style="color: #008080;">203</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">204</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">205</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">206</span> <span style="color: #000000;">}
</span><span style="color: #008080;">207</span> &lt;script runat=<span style="color: #800000;">"</span><span style="color: #800000;">template</span><span style="color: #800000;">"</span>&gt;
<span style="color: #008080;">208</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">bool</span><span style="color: #000000;"> IsIdentityPK()
</span><span style="color: #008080;">209</span> <span style="color: #000000;">{
</span><span style="color: #008080;">210</span>     <span style="color: #0000ff;">foreach</span>(ColumnSchema column <span style="color: #0000ff;">in</span><span style="color: #000000;"> TargetTable.Columns)
</span><span style="color: #008080;">211</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">212</span>         <span style="color: #0000ff;">if</span>((<span style="color: #0000ff;">bool</span>)column.ExtendedProperties[<span style="color: #800000;">"</span><span style="color: #800000;">CS_IsIdentity</span><span style="color: #800000;">"</span><span style="color: #000000;">].Value) 
</span><span style="color: #008080;">213</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">214</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">215</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">216</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">217</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">218</span> <span style="color: #000000;">}
</span><span style="color: #008080;">219</span> 
<span style="color: #008080;">220</span> <span style="color: #808080;">///////////////////////////////////////////////////////////////
</span><span style="color: #008080;">221</span> <span style="color: #008000;">//</span><span style="color: #008000;"> CLASS NAMES by Shen Bo</span>
<span style="color: #008080;">222</span> <span style="color: #808080;">///////////////////////////////////////////////////////////////
</span><span style="color: #008080;">223</span> <span style="color: #008000;">//</span><span style="color: #008000;"> UserService</span>
<span style="color: #008080;">224</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetDALClassName()
</span><span style="color: #008080;">225</span> <span style="color: #000000;">{
</span><span style="color: #008080;">226</span>     <span style="color: #0000ff;">return</span>     GetModelClassName() +<span style="color: #000000;"> DALClassNameSurfix;
</span><span style="color: #008080;">227</span> <span style="color: #000000;">}
</span><span style="color: #008080;">228</span> <span style="color: #008000;">//</span><span style="color: #008000;"> User</span>
<span style="color: #008080;">229</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetModelClassName()
</span><span style="color: #008080;">230</span> <span style="color: #000000;">{
</span><span style="color: #008080;">231</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;">     GetModelClassName(TargetTable);
</span><span style="color: #008080;">232</span> <span style="color: #000000;">}
</span><span style="color: #008080;">233</span> <span style="color: #008000;">//</span><span style="color: #008000;"> user</span>
<span style="color: #008080;">234</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetModelMemberVarName()
</span><span style="color: #008080;">235</span> <span style="color: #000000;">{
</span><span style="color: #008080;">236</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> GetModelParamName();
</span><span style="color: #008080;">237</span> <span style="color: #000000;">}
</span><span style="color: #008080;">238</span> <span style="color: #008000;">//</span><span style="color: #008000;"> user</span>
<span style="color: #008080;">239</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetModelParamName()
</span><span style="color: #008080;">240</span> <span style="color: #000000;">{
</span><span style="color: #008080;">241</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> MakeCamel(GetModelClassName());
</span><span style="color: #008080;">242</span> <span style="color: #000000;">}
</span><span style="color: #008080;">243</span> 
<span style="color: #008080;">244</span> 
<span style="color: #008080;">245</span> <span style="color: #808080;">///////////////////////////////////////////////////////////////
</span><span style="color: #008080;">246</span> <span style="color: #008000;">//</span><span style="color: #008000;"> INSERT SQL LINES by Shen Bo</span>
<span style="color: #008080;">247</span> <span style="color: #808080;">///////////////////////////////////////////////////////////////
</span><span style="color: #008080;">248</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetAutoIncInsertSQLLine()
</span><span style="color: #008080;">249</span> <span style="color: #000000;">{
</span><span style="color: #008080;">250</span>     <span style="color: #0000ff;">string</span><span style="color: #000000;"> result;
</span><span style="color: #008080;">251</span>     result = <span style="color: #800000;">"</span><span style="color: #800000;">INSERT INTO </span><span style="color: #800000;">"</span> + TargetTable.Name + <span style="color: #800000;">"</span><span style="color: #800000;"> (</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">252</span>     <span style="color: #0000ff;">foreach</span>(ColumnSchema column <span style="color: #0000ff;">in</span><span style="color: #000000;"> TargetTable.NonPrimaryKeyColumns)
</span><span style="color: #008080;">253</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">254</span>         result += column.Name + <span style="color: #800000;">"</span><span style="color: #800000;">, </span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">255</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">256</span>     result = result.Substring(<span style="color: #800080;">0</span>, result.Length-<span style="color: #800080;">2</span><span style="color: #000000;">);
</span><span style="color: #008080;">257</span>     result += <span style="color: #800000;">"</span><span style="color: #800000;">) </span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">258</span>     result+=<span style="color: #800000;">"</span><span style="color: #800000;"> output inserted.</span><span style="color: #800000;">"</span>+<span style="color: #000000;">GetPKName();
</span><span style="color: #008080;">259</span>     result += <span style="color: #800000;">"</span><span style="color: #800000;"> VALUES (</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">260</span>     <span style="color: #0000ff;">foreach</span>(ColumnSchema column <span style="color: #0000ff;">in</span><span style="color: #000000;"> TargetTable.NonPrimaryKeyColumns)
</span><span style="color: #008080;">261</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">262</span>         result += <span style="color: #800000;">"</span><span style="color: #800000;">@</span><span style="color: #800000;">"</span> + column.Name + <span style="color: #800000;">"</span><span style="color: #800000;">, </span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">263</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">264</span>     result = result.Substring(<span style="color: #800080;">0</span>, result.Length-<span style="color: #800080;">2</span><span style="color: #000000;">);
</span><span style="color: #008080;">265</span>     result += <span style="color: #800000;">"</span><span style="color: #800000;">)</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">266</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
</span><span style="color: #008080;">267</span> <span style="color: #000000;">}
</span><span style="color: #008080;">268</span> 
<span style="color: #008080;">269</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetCommonInsertSQLLine()
</span><span style="color: #008080;">270</span> <span style="color: #000000;">{
</span><span style="color: #008080;">271</span>     <span style="color: #0000ff;">string</span><span style="color: #000000;"> result;
</span><span style="color: #008080;">272</span>     result = <span style="color: #800000;">"</span><span style="color: #800000;">INSERT INTO </span><span style="color: #800000;">"</span> + TargetTable.Name + <span style="color: #800000;">"</span><span style="color: #800000;"> (</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">273</span>     <span style="color: #0000ff;">foreach</span>(ColumnSchema column <span style="color: #0000ff;">in</span><span style="color: #000000;"> TargetTable.Columns)
</span><span style="color: #008080;">274</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">275</span>         result += column.Name + <span style="color: #800000;">"</span><span style="color: #800000;">, </span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">276</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">277</span>     result = result.Substring(<span style="color: #800080;">0</span>, result.Length-<span style="color: #800080;">2</span><span style="color: #000000;">);
</span><span style="color: #008080;">278</span>     result += <span style="color: #800000;">"</span><span style="color: #800000;">) </span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">279</span>     result += <span style="color: #800000;">"</span><span style="color: #800000;"> VALUES (</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">280</span>     <span style="color: #0000ff;">foreach</span>(ColumnSchema column <span style="color: #0000ff;">in</span><span style="color: #000000;"> TargetTable.Columns)
</span><span style="color: #008080;">281</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">282</span>         result += <span style="color: #800000;">"</span><span style="color: #800000;">@</span><span style="color: #800000;">"</span> + column.Name + <span style="color: #800000;">"</span><span style="color: #800000;">, </span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">283</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">284</span>     result = result.Substring(<span style="color: #800080;">0</span>, result.Length-<span style="color: #800080;">2</span><span style="color: #000000;">);
</span><span style="color: #008080;">285</span>     result += <span style="color: #800000;">"</span><span style="color: #800000;">)</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">286</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
</span><span style="color: #008080;">287</span> <span style="color: #000000;">}
</span><span style="color: #008080;">288</span> 
<span style="color: #008080;">289</span> <span style="color: #808080;">///////////////////////////////////////////////////////////////
</span><span style="color: #008080;">290</span> <span style="color: #008000;">//</span><span style="color: #008000;"> PRIMARY KEY TYPE by Shen Bo</span>
<span style="color: #008080;">291</span> <span style="color: #808080;">///////////////////////////////////////////////////////////////
</span><span style="color: #008080;">292</span> <span style="color: #008000;">//</span><span style="color: #008000;"> int</span>
<span style="color: #008080;">293</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetPKPropertyType()
</span><span style="color: #008080;">294</span> <span style="color: #000000;">{
</span><span style="color: #008080;">295</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;">     GetPKType(TargetTable);
</span><span style="color: #008080;">296</span> <span style="color: #000000;">}
</span><span style="color: #008080;">297</span> 
<span style="color: #008080;">298</span> <span style="color: #808080;">///////////////////////////////////////////////////////////////
</span><span style="color: #008080;">299</span> <span style="color: #008000;">//</span><span style="color: #008000;"> PRIMARY KEY NAME by Shen Bo</span>
<span style="color: #008080;">300</span> <span style="color: #808080;">///////////////////////////////////////////////////////////////
</span><span style="color: #008080;">301</span> <span style="color: #008000;">//</span><span style="color: #008000;"> Id</span>
<span style="color: #008080;">302</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetPKPropertyName()
</span><span style="color: #008080;">303</span> <span style="color: #000000;">{
</span><span style="color: #008080;">304</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> MakePascal(GetPKName());
</span><span style="color: #008080;">305</span> <span style="color: #000000;">}
</span><span style="color: #008080;">306</span> <span style="color: #008000;">//</span><span style="color: #008000;"> id</span>
<span style="color: #008080;">307</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetPKParamName()
</span><span style="color: #008080;">308</span> <span style="color: #000000;">{
</span><span style="color: #008080;">309</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> GetPKMemberVarName();    
</span><span style="color: #008080;">310</span> <span style="color: #000000;">}
</span><span style="color: #008080;">311</span> <span style="color: #008000;">//</span><span style="color: #008000;"> id</span>
<span style="color: #008080;">312</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetPKMemberVarName()
</span><span style="color: #008080;">313</span> <span style="color: #000000;">{
</span><span style="color: #008080;">314</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> MakeCamel(GetPKName());    
</span><span style="color: #008080;">315</span> <span style="color: #000000;">}
</span><span style="color: #008080;">316</span> <span style="color: #008000;">//</span><span style="color: #008000;"> Id</span>
<span style="color: #008080;">317</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetPKName()
</span><span style="color: #008080;">318</span> <span style="color: #000000;">{
</span><span style="color: #008080;">319</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> GetPKName(TargetTable);
</span><span style="color: #008080;">320</span> <span style="color: #000000;">}
</span><span style="color: #008080;">321</span> 
<span style="color: #008080;">322</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">string</span><span style="color: #000000;"> GetFileName()
</span><span style="color: #008080;">323</span> <span style="color: #000000;">{
</span><span style="color: #008080;">324</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.GetDALClassName() + <span style="color: #800000;">"</span><span style="color: #800000;">.cs</span><span style="color: #800000;">"</span><span style="color: #000000;">;
</span><span style="color: #008080;">325</span> <span style="color: #000000;">}
</span><span style="color: #008080;">326</span> 
<span style="color: #008080;">327</span> &lt;/script&gt;</pre>
</div>
<pre><em id="__mceDel"><span style="font-family: 'Microsoft YaHei'; font-size: 14px;">&nbsp;</span></em></pre>
<pre><em id="__mceDel"><span style="font-family: 'Microsoft YaHei'; font-size: 14px;">&nbsp;</span></em></pre>
<pre><br /><br /></pre>
<pre><span style="font-family: 'Microsoft YaHei'; font-size: 14px;">&nbsp;</span></pre>
<p>&nbsp;</p>
<div><img src="file:///C:\Users\Jay Jay\AppData\Roaming\Tencent\Users\449387122\QQ\WinTemp\RichOle\2[[44H88VQ9[[002O$E3H7O.png" alt="" /></div></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class = "postDesc">posted @ <span id="post-date">2014-11-28 11:54</span> <a href='http://www.cnblogs.com/sunniest/'>Sunnier</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>)  <a href ="https://i.cnblogs.com/EditPosts.aspx?postid=4128183" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(4128183);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=205616,cb_entryId=4128183,cb_blogApp=currentBlogApp,cb_blogUserGuid='43282244-7c70-e411-b908-9dcfd8948a71',cb_entryCreatedDate='2014/11/28 11:54:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id='comment_form' class='commentform'>
<a name='commentform'></a>
<div id='divCommentShow'></div>
<div id='comment_nav'><span id='span_refresh_tips'></span><a href='javascript:void(0);' onclick='return RefreshCommentList();' id='lnk_RefreshComments' runat='server' clientidmode='Static'>刷新评论</a><a href='#' onclick='return RefreshPage();'>刷新页面</a><a href='#top'>返回顶部</a></div>
<div id='comment_form_container'></div>
<div class='ad_text_commentbox' id='ad_text_under_commentbox'></div>
<div id='ad_t2'></div>
<div id='opt_under_post'></div>
<div id='cnblogs_c1' class='c_ad_block'></div>
<div id='under_post_news'></div>
<div id='cnblogs_c2' class='c_ad_block'></div>
<div id='under_post_kb'></div>
<div id='HistoryToday' class='c_ad_block'></div>
<script type='text/javascript'>
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright &copy;2017 Sunnier
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
</body>
</html>
